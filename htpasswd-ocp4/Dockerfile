FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBodHBhc3N3ZC1vY3A0CmRlc2NyaXB0aW9uOiBDb25maWd1\
cmVzIEhUUGFzc3dkIGF1dGhlbnRpY2F0aW9uIG9uIGFuIE9DUCA0IGNsdXN0ZXIKYmluZGFibGU6\
IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogaHRwYXNzd2Qt\
b2NwNApwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBDb25maWd1cmVz\
IGF1dGhlbnRpY2F0aW9uIHVzaW5nIGh0cGFzc3dkIGFuZCBjcmVhdGVzIHVzZXJzCiAgICBmcmVl\
OiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgIHBhcmFt\
ZXRlcnM6CiAgICAtIG5hbWU6IGFkbWluX3VzZXJuYW1lCiAgICAgIHRpdGxlOiBBZG1pbiBVc2Vy\
bmFtZQogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlcm5hbWUKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIGRpc3BsYXlf\
dHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBBZG1pbiB1c2VybmFtZQogICAgLSBuYW1l\
OiBhZG1pbl9wYXNzd29yZAogICAgICB0aXRsZTogQWRtaW4gUGFzc3dvcmQKICAgICAgZGVzY3Jp\
cHRpb246IEFkbWluIHBhc3N3b3JkCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEFk\
bWluIFVzZXIKICAgIC0gbmFtZTogdXNlcl9jb3VudAogICAgICB0aXRsZTogTnVtYmVyIG9mIHJl\
Z3VsYXIgdXNlcnMKICAgICAgZGVzY3JpcHRpb246IE51bWJlciBvZiByZWd1bGFyIHVzZXJzCiAg\
ICAgIHR5cGU6IGludAogICAgICBkZWZhdWx0OiAxCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAg\
IGRpc3BsYXlfZ3JvdXA6IFJlZ3VsYXIgdXNlcnMKICAgIC0gbmFtZTogdXNlcl91c2VybmFtZV9m\
b3JtYXQKICAgICAgdGl0bGU6IEZvcm1hdCB0byBhcHBseSB0byB0aGUgdXNlcm5hbWVzCiAgICAg\
IGRlc2NyaXB0aW9uOiBGb3JtYXQgdG8gYXBwbHkgdG8gdGhlIHVzZXJuYW1lcwogICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGVmYXVsdDogdXNlciVkCiAgICAg\
IGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBSZWd1bGFyIHVzZXJzCiAg\
ICAtIG5hbWU6IHVzZXJfcGFzc3dvcmQKICAgICAgdGl0bGU6IFBhc3N3b3JkIGZvciB0aGUgcmVn\
dWxhciB1c2VycwogICAgICBkZXNjcmlwdGlvbjogUGFzc3dvcmQgZm9yIHRoZSByZWd1bGFyIHVz\
ZXJzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkZWZhdWx0\
OiBvcGVuc2hpZnQKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IFJlZ3VsYXIgdXNlcnMK"

RUN yum -y install httpd-tools && yum clean all

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb